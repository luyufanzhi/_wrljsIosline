let _readFile_Diamond4={init:function(t,n){this.filepath=t;this._json=[];this._lon_line_num=0;this._lat_line_num=0;this._type=n;this._gjLon=0;this._gjLat=0;this._minLon=0;this._minLat=0},start:function(){_this=this;$.ajaxSettings.async=false;$.get(_this.filepath,function(t){let n=t.split("\n");let e=n[2].trim().split(/\s+/);_propertys2=n[3].trim().split(/\s+/);let l=parseFloat(e[0]),_=parseFloat(e[1]),i=parseFloat(e[2]),a=parseFloat(e[3]),o,s;_this._lon_line_num=parseInt(typeof e[6]=="undefined"?_propertys2[0]:e[6]);_this._lat_line_num=parseInt(typeof e[7]=="undefined"?_propertys2[1]:e[7]);_this._gjLon=l;_this._gjLat=_;_mLon=(l+"").indexOf(".")!=-1?(l+"").length-(l+"").indexOf("."):"0";_mLat=(_+"").indexOf(".")!=-1?(_+"").length-(_+"").indexOf("."):"0";o=parseFloat(e[4]),s=parseFloat(e[5]);_this._minLat=s<o?s:o;_this._minLon=i;let h=true;for(let t=3;t<n.length;t++){if(!h){break}let s=n[t].split(/\s+/);for(let t in s){if(s[t].trim()!=""){_this._json.push({lat:o,lon:i,val:s[t]});i=i._add(l);if(i._sub(l)==a){o=o._add(_);i=parseFloat(e[2])}if(_this._json.length==_this._lon_line_num*_this._lat_line_num){h=false;break}}}}});$.ajaxSettings.async=true},getJson:function(){return this._json},getXSJson:function(t,n){let e=0,l=0,_=true;let i=[];for(let a of this._json){if(e==0&&_){i.push(a)}e++;l++;if(e==t||l%_lon_line_num==0){e=0}if(l==_lon_line_num*n){_=!_;l=0}if(l==_lon_line_num&&_){_=!_}}return i},_draw:function(t){_this=this;let n={_gjLon:_this._gjLon,_gjLat:_this._gjLat,_lat_line_num:_this._lat_line_num,_lon_line_num:_this._lon_line_num,_minLon:_this._minLon,_minLat:_this._minLat,_color:[[167,239,228],[170,237,211],[175,234,197],[165,229,179],[145,224,155],[125,216,127],[116,211,107],[112,206,90],[109,198,73],[108,193,56],[112,188,41],[116,181,27],[127,178,17],[255,255,255],[0,48,255],[0,121,255],[0,168,255],[0,204,255],[0,234,255],[0,255,198],[0,255,96],[150,255,0],[222,255,0],[255,252,0],[255,216,0],[255,186,0],[255,138,0],[255,102,0],[255,60,0],[255,0,0],[201,0,0],[149,0,0]],_level:[-72,-68,-64,-60,-56,-52,-48,-44,-40,-36,-32,-28,-24,-20,-16,-12,-8,-4,-2,0,4,8,12,16,18,20,24,28,32,36,40,45],_tar:"#canvas",_create:false,_alpha:.75,_json:_this._json,_tarwidth:6e3};$.extend(n,t);let e=$(n._tar),l,_;if(e[0]==null&&!n._create){alert("目标对象不存在, 请检查有没有准备这个canvas图层,或者修改_create属性自动创建")}else if(e[0]==null&&n._create){_target=document.createElement("canvas");_target.style.display="block";_target.height=n._tarwidth/n._lon_line_num*n._lat_line_num;_target.width=n._tarwidth;l=_target.getContext("2d");l.width=n._tarwidth;l.height=n._tarwidth/n._lon_line_num*n._lat_line_num;l.globalAlpha=n._alpha;_=_target}else{l=e[0].getContext("2d");l.width=e[0].width;l.height=e[0].height;l.globalAlpha=n._alpha;_=e[0]}let i=[],a=0,o=[];for(let t of n._json){a++;o.push(t);if(a==n._lon_line_num){a=0;i.push(o);o=[]}}while(i.length*i[0].length<1e5){i=_this._xhwg(i)}for(let t in i){for(let e of i[t]){l.beginPath();l.fillStyle=_this._getColor(e.val,n._level,n._color);l.rect(_this._calcL(l,e.lon,n._minLon,n._lon_line_num,n._gjLon,"w"),_this._calcL(l,e.lat,n._minLat,n._lat_line_num,n._gjLat,"h"),l.width/n._lon_line_num,l.height/n._lat_line_num);l.fill()}}return _},_calcL:function(t,n,e,l,_,i){n=_<0?e*2+(l-1)*Math.abs(_)-n:n;return(n-e)*((i=="w"?t.width:t.height)/l/Math.abs(_))},_getColor:function(t=0,n,e){for(p in n){p=parseInt(p);if(p<n.length){if(n[p]<=parseInt(t)&&n[p+1]>parseInt(t)){return"rgb("+e[p][0]+","+e[p][1]+","+e[p][2]+")"}}else{return"rgb("+e[p][0]+","+e[p][1]+","+e[p][2]+")"}}return"rgba(255,255,255,0)"},_xhwg:function(t){let n=[],e=[],l=[],_=[];for(let l in t){e=[];for(let n=0;n<t[l].length;n++){e.push(t[l][n]);if(n!=t[l].length-1){e.push({lat:t[l][n].lat,lon:parseFloat(t[l][n].lon)._add(parseFloat(t[l][n+1].lon))/2,val:parseFloat(t[l][n].val)._add(parseFloat(t[l][n+1].val))/2})}}n.push(e)}for(let t=0;t<n.length;t++){_.push(n[t]);l=[];if(t!=n.length-1){for(let e=0;e<n[t].length;e++){l.push({lat:parseFloat(n[t][e].lat)._add(parseFloat(n[t+1][e].lat))/2,lon:n[t][e].lon,val:parseFloat(n[t][e].val)._add(parseFloat(n[t+1][e].val))/2})}_.push(l)}}return _}};Math._add=function(t,n){let e,l,_;try{e=t.toString().split(".")[1].length}catch(t){e=0}try{l=n.toString().split(".")[1].length}catch(t){l=0}_=Math.pow(10,Math.max(e,l));return(t*_+n*_)/_};Number.prototype._add=function(t){return Math._add(t,this)};Math._sub=function(t,n){let e,l,_,i;try{e=t.toString().split(".")[1].length}catch(t){e=0}try{l=n.toString().split(".")[1].length}catch(t){l=0}_=Math.pow(10,Math.max(e,l));i=e>l?e:l;return((t*_-n*_)/_).toFixed(i)};Number.prototype._sub=function(t){return Math._sub(this,t)};function _readFileDiamond4(){this.init.apply(this,arguments);this.start()}_readFileDiamond4.prototype=_readFile_Diamond4;